<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="JEDao">

	<select id="JEProductTotal" resultType="int">
		SELECT count(*) FROM product
	</select>
	
	<select id="JEProductListAll" parameterType="Product" resultType="Product">
		SELECT *
		FROM (
        		SELECT rownum rn, a.*
        		FROM (SELECT * FROM product ORDER BY pno) a
     		 )
		WHERE rn BETWEEN #{start} AND #{end}
	</select>
	
	<select id="JEProductSelOne" parameterType="int" resultType="Product">
		SELECT * FROM product WHERE pno = #{pno}
	</select>
	
	<update id="JEProductUpdate" parameterType="Product">
		UPDATE product SET title=#{title}, category=#{category}, genre=#{genre}, 
						   year=#{year}, country=#{country}, 
						   director=#{director}, casting=#{casting}, price=#{price},
						   description=#{description}, p_img=#{p_img}, p_video=#{p_video}
		WHERE pno=#{pno}
	</update>
	
	<select id="JESelectManager" resultType="Product">
	
	</select>
	
	<select id="insertProduct" parameterType="Product">
		INSERT INTO product
		VALUES(product_pno_seq, #{title}, #{category}, #{genre}, #{year}, #{country}, #{director}, #{casting}, #{description}, #{price}, #{p_img}, #{p_video})
	</select>
	
	<delete id="deleteProduct" parameterType="int">
		DELETE FROM product
		WHERE pno=#{pno}
	</delete>
	
	<!-- 카테고리별 상품 리스트: 1차 분류 -->
	<select id="products_1" resultType="Product">
		SELECT p.pno, p.title, p.category, p.genre, p.p_img, c.category, c.genre, c.cat_name, c.gen_name
		FROM product p
		INNER JOIN category c
		ON p.genre = c.genre
		WHERE p.genre = #{genre} OR c.category = #{category}
	</select>
	
	<!-- 카테고리별 상품 리스트: 2차 분류 -->
	<select id="products_2" resultType="Product">
		SELECT p.pno, p.title, p.category, p.genre, p.p_img, c.category, c.genre, c.cat_name, c.gen_name
		FROM product p
		INNER JOIN category c
		ON p.genre = c.genre
		WHERE p.genre = #{genre}
	</select>
	
	<!-- 상품 상세정보 -->
	<select id="JEProductDetail" parameterType="int" resultType="Product">
		SELECT * FROM product WHERE pno = #{pno}
	</select>
	
	<!-- 카트 담기 -->
	<insert id="addCart">
 		INSERT INTO cart (no, id, title, count, price)
 		VALUES (cart_no_seq, #{id}, #{title}, #{count}, #{price})
	</insert>
	
	<!-- 카트 리스트 -->
	<select id="cartList" resultType="CartList">
		SELECT row_number() over(order by c.no desc) as no, c.no, c.id, c.pno, p.title, p.price, p.p_img
		FROM cart c
		INNER JOIN product p
		ON c.pno = p.pno
		WHERE c.id = #{id}
	</select>
	
	<!-- 카트 삭제 -->
	<delete id="deleteCart">
		DELETE cart
     	WHERE no = #{no}
        AND id = #{id}
</delete>
	
</mapper>

